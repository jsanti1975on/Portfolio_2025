✅ Cyber Range Update: Link Aggregation (ESXi ↔ Cisco Switch)
Step 1 – Cisco Switch (East) Configuration

Using PuTTY on the jump box:

en
conf t
!
! Create the EtherChannel for fa0/5 and fa0/6
interface range fa0/5 - 6
 switchport mode trunk
 channel-group 2 mode active
 exit
!
! Verify
show etherchannel summary


➡️ mode active enables LACP (802.3ad).
➡️ switchport mode trunk allows multiple VLANs (management, VM, etc.) to pass.

Step 2 – ESXi Host Configuration

On your ESXi host GUI:

Go to Networking → vSwitches.

Edit the vSwitch connected to vmnic2 + vmnic3.

Under NIC Teaming:

Load balancing → Route based on IP hash

Network failover detection → Link status only

Failback → Yes

Both vmnic2 and vmnic3 should be set to Active

Save and confirm.

Step 3 – Verification

On Cisco Switch:

show etherchannel summary


You should see Po2 (LACP) up with fa0/5 & fa0/6 bundled.

On ESXi Host:

Go to Networking → Physical NICs and confirm both vmnic2 & vmnic3 are Active.

Run a VM on that vSwitch and ping across VLAN 10 (172.20.10.0/24).

Notes for GitHub Documentation

The cyber range now supports two separate EtherChannels:

Po1 (fa0/1 & fa0/2) uplink to Cisco RV340 (router for VLAN 10 traffic).

Po2 (fa0/5 & fa0/6) uplink to ESXi host (VM network).

VLAN 10 (172.20.10.0/24) is routed via Cisco RV340 and available to VMs on ESXi.

VLAN 2 (10.10.10.0/24) remains management + pfSense.

VLAN 1 (192.168.0.0/24) remains IoT + guest wireless.

⚠️ Important: The MAC flapping you saw earlier was because the switch saw the same MAC on multiple ports (before EtherChannel config was fully synced). Now that both sides (ESXi + Cisco) are using IP Hash + LACP, this should stop.
